2. ViÃªÌt Logger chung cho toaÌ€n bÃ´Ì£ bÃªn ngoaÌ€i
+ ghi log vaÌ€o 1 file (mÃ´Ìƒi lÃ¢Ì€n restart Pi laÌ€ 1 file khaÌc nhau, coÌ€n restart app thiÌ€ ko)
+ NÃ‚NG CAO: quaÌ bao nhiÃªu MB thiÌ€ qua log mÆ¡Ìi duÌ€ ko restart Pi
+ NÃ‚NG CAO: Giáº£i nÃ©n file

5. Viáº¿t RecordManager (ALSA API Ä‘á»ƒ ghi Ã¢m)
mpv ten_file.wav
ffplay ten_file.wav
aplay ten_file.wav (CuÌ‰a ALSA thiÌ€ phaÌ‰i)
Note: ChÆ°a biáº¿t cÃ¡i nÃ o lÃ  best practice

7. Unit test dÃ¹ng gg test (CÃ³ CmakeList riÃªng)
- Cho tháº±ng coremgr lÃ  Ä‘Æ°á»£c
- XÃ i GMOCK + CmakeList cho nÃ³ chuáº©n chuyÃªn nghiá»‡p.

8. Viáº¿t CloundManager nháº­n tÃ­n hiá»‡u tá»« CoreManager
-CoreManager nháº­n tÃ­n hiá»‡u tá»« HardwareManager. 
-Má»—i 5s báº¯n cho CoreManager má»™t phÃ¡t
-Náº¿u mÃ  nhiá»‡t Ä‘á»™ / tÃ¬nh tráº¡ng CPU / ... cá»§a Pi 4 ko chÃªnh lá»‡ch quÃ¡ bao nhiÃªu % Ä‘Ã³ thÃ¬ sáº½ ko
    gá»­i Ä‘áº¿n CloundManager. 
- CÃ²n ko thÃ¬ update lÃªn CloudManager

9. XÃ i queue cho HardwareMÃ¢nger

10. LoÌ£c taÌ£p Ã¢m (sau khi ghi Ã¢m = 1 thread khÃ¡c cá»§a RecordManager)
Sau Ä‘Ã³ báº¯n NOTI cho CoreManager Ä‘á»ƒ CoreManager lÆ°u vÃ o Database + gá»­i lÃªn web

15. Cáº§n cÃ³ xá»­ lÃ½ Timer Timeout á»Ÿ CoreManager, tá»©c nÃ³ pháº£i nháº­n NOTI sau máº¥y giÃ¢y ko thÃ¬ nÃ³ sáº½ tá»± Ä‘á»™ng tráº£ vá» App status false
vÃ  kill tháº±ng service Ä‘Ã³ (Äá»ƒ nÃ³ start láº¡i)

===============================================================
tá»©c lÃ  tÃ´i cáº§n viáº¿t má»™t daemon C++ Ä‘á»ƒ liÃªn tá»¥c kiá»ƒm tra ráº±ng tÃ´i cÃ³ Ä‘ang káº¿t ná»‘i (pair) vá»›i Loa nÃ o khÃ´ng. Kiá»ƒu cÃ³ thá»ƒ xÃ¡c Ä‘á»‹nh Ä‘Ã³ lÃ  output loa chá»© ko pháº£i pair vá»›i phone, chuá»™t PC, ... Sau Ä‘Ã³ sáº½ update thÃ´ng tin chÃ­nh xÃ¡c lÃ  Loa tá»›i má»™t daemon C++ khÃ¡c (vÃ­ dá»¥ AudioManager) Ä‘á»ƒ Ä‘Æ°á»£c phÃ©p phÃ¡t audio file ra loa qua bluetooth.
//////

ÄÃºng váº­y â€” báº¡n hoÃ n toÃ n cÃ³ thá»ƒ viáº¿t má»™t daemon C++ Ä‘á»ƒ giÃ¡m sÃ¡t cÃ¡c thiáº¿t bá»‹ Bluetooth Ä‘ang káº¿t ná»‘i, lá»c ra thiáº¿t bá»‹ lÃ  loa (audio sink), vÃ  gá»­i thÃ´ng tin Ä‘Ã³ Ä‘áº¿n má»™t daemon khÃ¡c nhÆ° AudioManager. Tuy nhiÃªn, Ä‘á»ƒ lÃ m Ä‘iá»u nÃ y Ä‘Ãºng cÃ¡ch, báº¡n nÃªn sá»­ dá»¥ng D-Bus API cá»§a BlueZ.

ğŸ§  Tá»•ng quan kiáº¿n trÃºc
BlueZ lÃ  Bluetooth stack chÃ­nh thá»©c trÃªn Linux.

bluetoothd lÃ  daemon chÃ­nh cá»§a BlueZ, cung cáº¥p API qua D-Bus.

Báº¡n sáº½ viáº¿t má»™t daemon C++:

Káº¿t ná»‘i D-Bus system bus.

Theo dÃµi cÃ¡c thiáº¿t bá»‹ Bluetooth thÃ´ng qua org.bluez.Adapter1, org.bluez.Device1, org.bluez.MediaControl1, v.v.

Lá»c cÃ¡c thiáº¿t bá»‹ cÃ³ Class hoáº·c UUID tÆ°Æ¡ng á»©ng vá»›i audio sink (vÃ­ dá»¥: 0000110b-0000-1000-8000-00805f9b34fb lÃ  A2DP Sink).

Khi phÃ¡t hiá»‡n thiáº¿t bá»‹ loa Ä‘Æ°á»£c káº¿t ná»‘i, gá»­i thÃ´ng tin Ä‘áº¿n AudioManager (qua socket, D-Bus, hoáº·c shared memory tÃ¹y báº¡n thiáº¿t káº¿).

Láº¯ng nghe signal PropertiesChanged trÃªn interface org.bluez.Device1.

Kiá»ƒm tra thuá»™c tÃ­nh:

Connected = true

UUIDs chá»©a A2DP Sink hoáº·c AudioSink UUID

Alias hoáº·c Name chá»©a tá»« khÃ³a nhÆ° "Speaker", "JBL", "Bose"...

ğŸ§ª Gá»£i Ã½ kiá»ƒm thá»­
DÃ¹ng bluetoothctl Ä‘á»ƒ pair vÃ  connect loa thá»§ cÃ´ng.

Cháº¡y daemon cá»§a báº¡n song song Ä‘á»ƒ xem log cÃ³ phÃ¡t hiá»‡n Ä‘Ãºng thiáº¿t bá»‹ khÃ´ng.

DÃ¹ng pactl list sinks Ä‘á»ƒ kiá»ƒm tra thiáº¿t bá»‹ audio Ä‘áº§u ra tÆ°Æ¡ng á»©ng.